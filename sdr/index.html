<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">

    <title>Software-defined radio with PDL, HackRF, and RTL-SDR</title>

    <meta name="author" content="Doug Hoyte">

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

    <link rel="stylesheet" href="../reveal.js/css/reveal.css">
    <link rel="stylesheet" href="../reveal.js/css/theme/white.css" id="theme">

    <!-- Code syntax highlighting -->
    <link rel="stylesheet" href="../reveal.js/lib/css/zenburn.css">

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? '../reveal.js/css/print/pdf.css' : '../reveal.js/css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>

    <!--[if lt IE 9]>
    <script src="../reveal.js/lib/js/html5shiv.js"></script>
    <![endif]-->

    <style>
      .reveal .slides h1, .reveal .slides h2, .reveal .slides h3 {
        text-transform: none;
      }

      .reveal .slides img {
        border: 0;
        box-shadow: none;
      }
    </style>
  </head>

  <body>
    <div class="reveal">
      <div class="slides">

<!------------------------------------------------------->

<section data-markdown><script type="text/template">

# Software-defined radio with PDL, HackRF, and RTL-SDR

### Doug Hoyte

CPAN: FRACTAL

Amateur radio: VE3HOY

</script></section>


<section data-markdown><script type="text/template">

# Software-defined radio

* Computers are fast enough now that things that used to be implemented in hardware can now be done in software

* Much more flexible: One simple device can support many protocols, modulations, and frequencies

* A "sound card for radio"

</script></section>


<section data-markdown><script type="text/template">

# Demo 1: GQRX

GQRX is a radio receiver

* Built on GNU Radio (more on this later)
* Waterfall shows signal strength by frequency over time

![Waterfall](waterfall.png)

</script></section>


<section data-markdown><script type="text/template">

# Sampling

Sampling is the process of taking measurements of a continuous signal at evenly spaced periods of time

![Sampling 1](sampling1.svg)

</script></section>


<section data-markdown><script type="text/template">

Since we use digital computers, measurement values are also discrete

![Sampling 2](sampling2.svg)

</script></section>


<section data-markdown><script type="text/template">

We aren't recording what happens between samples, and are only approximately recording these samples

![Sampling 3](sampling3.svg)

</script></section>



<section data-markdown><script type="text/template">

# Aliasing

* All collections of discrete samples are ambiguous
* Each represents an infinte number of continuous signals (aliases)

![Aliased Sines](gen/aliased-sines.svg)

</script></section>


<section data-markdown><script type="text/template">

Aliases occur as mirror images around half the sampling rate (the "nyquist frequency")

![Aliasing 1](aliasing1.svg)

</script></section>


<section data-markdown><script type="text/template">

Aliases also occur above the sample rate

![Aliasing 2](aliasing2.svg)

</script></section>



<section data-markdown><script type="text/template">

And even at negative frequencies

![Aliasing 3](aliasing3.svg)

</script></section>


<section data-markdown><script type="text/template">

Think of the sampled frequency spectrum as a circle

![Aliasing 4](aliasing4.svg)

</script></section>



<section data-markdown><script type="text/template">

# SDR perl module

Simple receiver

      use SDR;

      my $radio = SDR->radio(can => "rx");

      $radio->frequency(97_300_000);
      $radio->sample_rate(2_000_000);

      $radio->rx(sub {
        ## process samples in $_[0]
        ## called several times per second -- be fast!
      });

      $radio->run; ## enter event loop

</script></section>



<section data-markdown><script type="text/template">

Transmitting is just as easy

      use SDR;

      my $radio = SDR->radio(can => "tx");

      $radio->frequency(97_300_000);
      $radio->sample_rate(2_000_000);

      $radio->tx(sub {
        ## return perl reference to $_[0] bytes of samples
        ## called several times per second -- be fast!
      });

      $radio->run; ## enter event loop 

</script></section>



<section data-markdown><script type="text/template">

So, how do we make our callbacks fast?

# Perl Data Language

* Loop over large amounts of data efficiently
* Like matlab, numpy
* Multi-core capable
* Learn more: http://pdl.perl.org/

</script></section>


<section data-markdown><script type="text/template">

PDL lets you work with arrays like simple perl variables

      use PDL;

      my $x = sequence(10);
      print $x;
      ## [0 1 2 3 4 5 6 7 8 9]

      print $x + 100;
      ## [100 101 102 103 104 105 106 107 108 109]

      print cos($x);
      ## [1 0.54030231 -0.41614684 -0.9899925 ... ]

      use PDL::Complex;
      print $x + (2 * i);
      ## [0 +2i  1 +2i  2 +2i  3 +2i  4 +2i ... ]

</script></section>


<section data-markdown><script type="text/template">

# IQ Samples

</script></section>


<section data-markdown><script type="text/template">

# Demo 2: SSB transmission

      $radio->tx(sub {
        my $block_size = shift;

        my $time = sequence($block_size / 2);

        my $radians = 2 * PI * ($freq / $sample_rate) * $time;

        my $signal = cos($radians) + i * sin($radians);

        $signal += 128 + (128 * i);
 
        return $signal->byte->flat->get_dataref;
      });

</script></section>


<section data-markdown><script type="text/template">

The clicking sound comes from abrupt phase changes &mdash; we aren't keeping track of the signal's phase between blocks

![Phase Discontinuity](gen/phase-discontinuity.svg)

</script></section>


<section data-markdown><script type="text/template">

# Fix the clicking

      my $curr_sample = 0;

      $radio->tx(sub {
        my $block_size = shift;

        my $time = sequence($block_size / 2) + $curr_sample;
        $curr_sample += $block_size / 2;

        my $radians = 2 * PI * ($freq / $sample_rate) * $time;

        my $signal = cos($radians) + i * sin($radians);

        $signal += 128 + (128 * i);

        return $signal->byte->flat->get_dataref;
      });

</script></section>



<section data-markdown><script type="text/template">

# Demo 3: FM transmission

Try the no-clicking script and listen to it with an FM radio

* It's an unmodulated carrier so there is no tone
* But all the noise goes away: *full-quieting*

</script></section>



<section data-markdown><script type="text/template">

## Let's try that clicking demo with an FM receiver instead

<div class="fragment">
**It still clicks!**

Only the phase is changing, not the frequency, so why does it click? We'll come back to this...
</div>

</script></section>



<section data-markdown><script type="text/template">

## Play a tone over FM

To frequency modulate the carrier, we just need to adjust its phase using the signal we want to transmit:

      my $tone_freq = 1000;

      my $tone = 50 * sin(2 * PI * ($tone_freq/$sample_rate) * $time);

      my $signal = cos($radians + $tone) + i * sin($radians + $tone);

</script></section>



<!--

intro

gqrx
  - waterfall

sampling
  - aliasing
  - IQ samples

SDR
  - tx
  - rx

PDL

transmitter demo
  - SSB signal
    - phase discontinuity
    - how to fix it
  - FM carrier
    - full quieting
    - modulate a tone
    ? module music

gnu radio
  - rev eng RC car protocol

rc car demo
  - code walk-through

complex baseband
  - negative frequency
  - sidebands
  - bandwidth

fm receiver demo
  - decimation/interpolation
  - code walk-through

phase modulation
  - PSK-31
  - constellations
  - varicode
    - fibonacci codes
  - frequency is derivative of phase
  - fldigi

-->






<!------------------------------------------------------->


      </div>

    </div>

    <script src="../reveal.js/lib/js/head.min.js"></script>
    <script src="../reveal.js/js/reveal.js"></script>

    <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,

        transition: 'none', // none/fade/slide/convex/concave/zoom

        // Optional reveal.js plugins
        dependencies: [
          { src: '../reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: '../reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: '../reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
        ]
      });

    </script>

  </body>
</html>
